# 等待/通知机制

```
//等待方：标准使用情况
synchronized (obj) {
    while(<condition does not hold>){
        obj.wait()
    }
    // ......

}

//通知方：标准使用情况
synchronized (obj) {
    <change conditon>
    obj.notifyAll();
}
```

* ### 等待者要始终在while循环模式中，来调用wait\(\)方法。
* ### 等待者：1.获取对象锁。2.判断条件满足，调用锁的wait\(\)方法，进入WAITING状态并释放对象锁。3.等待被通知后，判断条件不满足，然后继续执行接下来的逻辑。
* ### 通知者：1.获取对象锁。2.改变等待者的条件。3.调用锁的notifyAll\(\)方法，继续执行完毕剩下的逻辑，然后等待者才会继续。

## 一些原则：

* ### 有一个条件谓词，线程执行前必须先通过测试
* ### 在调用wait之前测试条件谓词，被通知后要再次测试
* ### 在一个循环中调用wait
* ### 要在持有锁的时候，调用wait\(\),notifyAll\(\),notify\(\)方法
* ### 只有在1.所有等待线程的类型都相同。2.只能由一个线程来执行，此时才能调用notify\(\)方法，其他情况都调用notifyAll\(\)方法。



# 为什么要在一个循环中，调用wait\(\)方法？

1. ### 当某个地方要唤醒线程之前，会将即将要唤醒的线程之前的volatile变量设置为true，然后才会调用notifyAll\(\)方法。
2. ### 此时所有的线程都会唤醒，但还是在循环中，不满足条件的线程会重新调用wait\(\)方法进入WAIT状态。
3. ### 只有满足条件的线程才会跳出循环并往下执行。

### 



